// -----------------------------------------------------------------------------
// loznotes is a notation layer for conveying information about wireframes, 
// mockups and design comps. Originally a fork, this now a complete rewrite of 
// Elliance's excellent Metaframe work (http://github.com/elliance/metaframe).
//
// ©2013-2014 Loz Gray – Creative Commons Attribution Sharealike 3.0 Unported 
// http://creativecommons.org/licenses/by-sa/3.0/
//
// Dependancies:
//
// loznotes.css
// -----------------------------------------------------------------------------
document.addEventListener("DOMContentLoaded",function(){function f(){var e=[].slice.call(location.search.substring(1).split("&"));if(e.indexOf("loznotes=hidden")>-1||e.indexOf("loznotes=hide")>-1){l();b();w();E();S()}else{if(e.indexOf("loznotes=off")>-1)return!1;l();w();E();S();document.querySelector("#loznotes__form__display-toggle").setAttribute("checked","checked")}}function l(){c();e=[].slice.call(document.querySelectorAll("[data-notation]"));h();p();y();i=[].slice.call(document.querySelectorAll(".loznotes__anchor a"))}function c(){if(document.querySelectorAll(".loznotes__tab-pane").length>0){var e=[].slice.call(document.querySelectorAll(".loznotes__anchor, .loznotes__tab-control, .loznotes__tab-pane"));for(var t=e.length-1;t>=0;t--)e[t].parentNode.removeChild(e[t])}}function h(){if(document.getElementsByTagName("body")[0].hasAttribute("data-notation")){t=e[0];e=e.splice(1)}}function p(){d();r=document.createElement("section");r.classList.add("loznotes__tab-pane");var e=document.createElement("h1");e.innerHTML=document.title;r.appendChild(e);v();var t=document.createElement("h2");t.innerHTML="Page Notes";r.appendChild(t);m();g();document.body.appendChild(r)}function d(){n=document.createElement("a");n.classList.add("loznotes__tab-control");n.title="Open and close the notation tab pane";n.href="#loznotes__tab";document.body.appendChild(n)}function v(){var e=document.createElement("form"),t=document.createElement("input"),n=document.createTextNode("Show note markers");e.classList.add("loznotes__form");t.setAttribute("type","checkbox");t.id="loznotes__form__display-toggle";e.appendChild(t);e.appendChild(n);r.appendChild(e)}function m(){if(t){var e=document.createElement("p");e.classList.add("loznotes__page-description");e.innerHTML=t.getAttribute("data-notation");r.appendChild(e)}}function g(){var t=document.createElement("dl");t.classList.add("loznotes__list");r.appendChild(t);for(var n=0;n<e.length;n++){var i=document.createElement("dt"),s="loznote--"+(n+1),o="loznote__count-"+(n+1),u=document.createElement("dd"),a="loznote_body-"+(n+1);i.id=s;i.classList.add("loznote__count");i.classList.add(o);u.classList.add("loznote__body");u.classList.add(a);i.innerHTML=n+1;u.innerHTML=e[n].getAttribute("data-notation");t.appendChild(i);t.appendChild(u)}}function y(){for(var t=0;t<e.length;t++){var n=document.createElement("figure"),r=document.createElement("a"),i="#loznote--"+(t+1);n.classList.add("loznotes__anchor");r.innerHTML=t+1;r.href=i;n.appendChild(r);e[t].firstChild?e[t].insertBefore(n,e[t].firstChild):e[t].appendChild(n)}}function b(){[].forEach.call(i,function(e){e.parentNode.classList.add("loznotes__anchor--is-hidden")})}function w(){[].forEach.call(i,function(e){e.addEventListener("click",function(){window.event.preventDefault();T(this)},!1)})}function E(){n.addEventListener("click",function(e){var t=document.querySelector(".loznote__anchor--is-selected");if(t){var n=t.querySelector("a").hash;t.classList.remove(s);document.querySelector(n).classList.remove(o)}x();r.scrollTop=0;e.preventDefault()},!1)}function S(){document.querySelector("#loznotes__form__display-toggle").addEventListener("click",function(){[].forEach.call(i,function(e){e.parentNode.classList.toggle("loznotes__anchor--is-hidden")})},!1)}function x(){n.classList.toggle(u);r.classList.toggle(a)}function T(e){var t=document.querySelector(".loznote__anchor--is-selected"),i=e.parentNode;if(t)if(i.classList.contains(s)){i.classList.remove(s);document.querySelector(e.hash).classList.remove(o);n.classList.remove(u);r.classList.remove(a);r.scrollTop=0}else{var f=t.querySelector("a").hash;t.classList.remove(s);document.querySelector(f).classList.remove(o);i.classList.add(s);document.querySelector(e.hash).classList.add(o);n.classList.add(u);r.classList.add(a);N(e.hash)}else{i.classList.add(s);document.querySelector(e.hash).classList.add(o);n.classList.add(u);r.classList.add(a);N(e.hash)}}function N(e){e==="#loznote--1"?r.scrollTop=0:r.scrollTop=document.querySelector(e).offsetTop-20}var e,t,n,r,i,s="loznote__anchor--is-selected",o="loznote__count--is-selected",u="loznotes__tab-control--is-active",a="loznotes__tab-pane--is-active";f()});