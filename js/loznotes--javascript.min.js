// -----------------------------------------------------------------------------
// loznotes is a notation layer for conveying information about wireframes, 
// mockups and design comps. Originally a fork, this now a complete rewrite of 
// Elliance's excellent Metaframe work (http://github.com/elliance/metaframe).
//
// ©2013-2014 Loz Gray – Creative Commons Attribution Sharealike 3.0 Unported 
// http://creativecommons.org/licenses/by-sa/3.0/
//
// Dependancies:
//
// loznotes.css
// -----------------------------------------------------------------------------
document.addEventListener("DOMContentLoaded",function(){function l(){var e=[].slice.call(location.search.substring(1).split("&"));if(e.indexOf("loznotes=hidden")>-1||e.indexOf("loznotes=hide")>-1){c();w();E();S();x()}else{if(e.indexOf("loznotes=off")>-1)return!1;c();E();S();x();document.querySelector("#loznotes__form__display-toggle").setAttribute("checked","checked")}}function c(){h();e=[].slice.call(document.querySelectorAll("[data-notation]"));p();d();b();i=[].slice.call(document.querySelectorAll(".loznotes__anchor a"))}function h(){if(document.querySelectorAll(".loznotes__tab-pane").length>0){var e=[].slice.call(document.querySelectorAll(".loznotes__anchor, .loznotes__tab-control, .loznotes__tab-pane"));for(var t=e.length-1;t>=0;t--)e[t].parentNode.removeChild(e[t])}}function p(){if(document.getElementsByTagName("body")[0].hasAttribute("data-notation")){t=e[0];e=e.splice(1)}}function d(){v();r=document.createElement("section");r.classList.add("loznotes__tab-pane");var e=document.createElement("h1");e.innerHTML=document.title;r.appendChild(e);m();var t=document.createElement("h2");t.innerHTML="Page Notes";r.appendChild(t);g();y();document.body.appendChild(r)}function v(){n=document.createElement("a");n.classList.add("loznotes__tab-control");n.title="Open and close the notation tab pane";n.href="#loznotes__tab";document.body.appendChild(n)}function m(){var e=document.createElement("form"),t=document.createElement("input"),n=document.createTextNode("Show note markers");e.classList.add("loznotes__form");t.setAttribute("type","checkbox");t.id="loznotes__form__display-toggle";e.appendChild(t);e.appendChild(n);r.appendChild(e)}function g(){if(t){var e=document.createElement("p");e.classList.add("loznotes__page-description");e.innerHTML=t.getAttribute("data-notation");r.appendChild(e)}}function y(){var t=document.createElement("dl");t.classList.add("loznotes__list");r.appendChild(t);for(var n=0;n<e.length;n++){var i=document.createElement("dt"),s="loznote--"+(n+1),o="loznote__count-"+(n+1),u=document.createElement("dd"),a="loznote_body-"+(n+1);i.id=s;i.classList.add("loznote__count");i.classList.add(o);u.classList.add("loznote__body");u.classList.add(a);i.innerHTML=n+1;u.innerHTML=e[n].getAttribute("data-notation");t.appendChild(i);t.appendChild(u)}}function b(){for(var t=0;t<e.length;t++){var n=document.createElement("figure"),r=document.createElement("a"),i="#loznote--"+(t+1);n.classList.add("loznotes__anchor");r.innerHTML=t+1;r.href=i;n.appendChild(r);e[t].firstChild?e[t].insertBefore(n,e[t].firstChild):e[t].appendChild(n)}}function w(){[].forEach.call(i,function(e){e.parentNode.classList.add(s)})}function E(){[].forEach.call(i,function(e){e.addEventListener("click",function(e){e.preventDefault();T(this)},!1)})}function S(){n.addEventListener("click",function(e){var t=document.querySelector(".loznotes__anchor--is-selected");if(t){var n=t.querySelector("a").hash;C(t,n)}A();r.scrollTop=0;e.preventDefault()},!1)}function x(){document.querySelector("#loznotes__form__display-toggle").addEventListener("click",function(){[].forEach.call(i,function(e){e.parentNode.classList.toggle(s)})},!1)}function T(e){var t=document.querySelector(".loznotes__anchor--is-selected"),n=e.parentNode,i=e.hash;if(t)if(n.classList.contains(o)){C(n,i);L();r.scrollTop=0}else{var s=t.querySelector("a").hash;C(t,s);N(n,i);k();O(i)}else{N(n,i);k();O(i)}}function N(e,t){e.classList.add(o);document.querySelector(t).classList.add(u)}function C(e,t){e.classList.remove(o);document.querySelector(t).classList.remove(u)}function k(){n.classList.add(a);r.classList.add(f)}function L(){n.classList.remove(a);r.classList.remove(f)}function A(){n.classList.toggle(a);r.classList.toggle(f)}function O(e){e==="#loznote--1"?r.scrollTop=0:r.scrollTop=document.querySelector(e).offsetTop-20}function M(){var e=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){this.addEventListener("readystatechange",_);e.apply(this,arguments)}}function _(){if(this.readyState===4)var e=setTimeout(function(){l()},1)}var e,t,n,r,i,s="loznotes__anchor--is-hidden",o="loznotes__anchor--is-selected",u="loznote__count--is-selected",a="loznotes__tab-control--is-active",f="loznotes__tab-pane--is-active";l();M()});