// -----------------------------------------------------------------------------
// loznotes is a notation layer for conveying information about wireframes, 
// mockups and design comps. Originally a fork, this now a complete rewrite of 
// Elliance's excellent Metaframe work (http://github.com/elliance/metaframe).
//
// ©2013-2014 Loz Gray – Creative Commons Attribution Sharealike 3.0 Unported 
// http://creativecommons.org/licenses/by-sa/3.0/
//
// Dependancies:
//
// loznotes.css
// -----------------------------------------------------------------------------
document.addEventListener("DOMContentLoaded",function(){function s(){var e=[].slice.call(location.search.substring(1).split("&"));if(e.indexOf("loznotes=hidden")>-1||e.indexOf("loznotes=hide")>-1){o();v();m();g();y()}else{if(e.indexOf("loznotes=off")>-1)return!1;o();m();g();y();document.querySelector("#loznotes__form__display-toggle").setAttribute("checked","checked")}}function o(){u();e=[].slice.call(document.querySelectorAll("[data-notation]"));a();f();d();i=[].slice.call(document.querySelectorAll(".loznotes__anchor a"))}function u(){if(document.querySelectorAll(".loznotes__tab-pane").length>0){var e=[].slice.call(document.querySelectorAll(".loznotes__anchor, .loznotes__tab-control, .loznotes__tab-pane"));for(var t=e.length-1;t>=0;t--)e[t].parentNode.removeChild(e[t])}}function a(){if(document.getElementsByTagName("body")[0].hasAttribute("data-notation")){t=e[0];e=e.splice(1)}}function f(){l();r=document.createElement("section");r.classList.add("loznotes__tab-pane");var e=document.createElement("h1");e.innerHTML=document.title;r.appendChild(e);c();var t=document.createElement("h2");t.innerHTML="Page Notes";r.appendChild(t);h();p();document.body.appendChild(r)}function l(){n=document.createElement("a");n.classList.add("loznotes__tab-control");n.title="Open and close the notation tab pane";n.href="#loznotes__tab";document.body.appendChild(n)}function c(){var e=document.createElement("form"),t=document.createElement("input"),n=document.createTextNode("Show note markers");e.classList.add("loznotes__form");t.setAttribute("type","checkbox");t.id="loznotes__form__display-toggle";e.appendChild(t);e.appendChild(n);r.appendChild(e)}function h(){if(t){var e=document.createElement("p");e.classList.add("loznotes__page-description");e.innerHTML=t.getAttribute("data-notation");r.appendChild(e)}}function p(){var t=document.createElement("dl");t.classList.add("loznotes__list");r.appendChild(t);for(var n=0;n<e.length;n++){var i=document.createElement("dt"),s="loznote--"+(n+1),o="loznote__count-"+(n+1),u=document.createElement("dd"),a="loznote_body-"+(n+1);i.id=s;i.classList.add("loznote__count");i.classList.add(o);u.classList.add("loznote__body");u.classList.add(a);i.innerHTML=n+1;u.innerHTML=e[n].getAttribute("data-notation");t.appendChild(i);t.appendChild(u)}}function d(){for(var t=0;t<e.length;t++){var n=document.createElement("figure"),r=document.createElement("a"),i="#loznote--"+(t+1);n.classList.add("loznotes__anchor");r.innerHTML=t+1;r.href=i;n.appendChild(r);e[t].firstChild?e[t].insertBefore(n,e[t].firstChild):e[t].appendChild(n)}}function v(){[].forEach.call(i,function(e){e.parentNode.classList.add("loznotes__anchor--is-hidden")})}function m(){[].forEach.call(i,function(e){e.addEventListener("click",function(){b();window.event.preventDefault();this.hash=="#loznote--1"?r.scrollTop=0:r.scrollTop=document.querySelector(this.hash).offsetTop-20},!1)})}function g(){n.addEventListener("click",function(e){b();r.scrollTop=0;e.preventDefault()},!1)}function y(){document.querySelector("#loznotes__form__display-toggle").addEventListener("click",function(){[].forEach.call(i,function(e){e.parentNode.classList.toggle("loznotes__anchor--is-hidden")})},!1)}function b(){n.classList.toggle("loznotes__tab-control--is-active");r.classList.toggle("loznotes__tab-pane--is-active")}function w(){var e={};e.tempOpen=XMLHttpRequest.prototype.open;e.tempSend=XMLHttpRequest.prototype.send;e.callback=function(){if(this.readyState==4){var e=setTimeout(function(){s()},1);e}};XMLHttpRequest.prototype.open=function(t,n){if(!t)var t="";if(!n)var n="";e.tempOpen.apply(this,arguments);e.method=t;e.url=n;if(t.toLowerCase()=="get"){e.data=n.split("?");e.data=e.data[1]}};XMLHttpRequest.prototype.send=function(t,n){if(!t)var t="";if(!n)var n="";e.tempSend.apply(this,arguments);e.method.toLowerCase()=="post"&&(e.data=t);this.onreadystatechange=e.callback}}var e,t,n,r,i;s();w()});