// -----------------------------------------------------------------------------
// loznotes is a notation layer for conveying information about wireframes, 
// mockups and design comps. Originally a fork, this now a complete rewrite of 
// Elliance's excellent Metaframe work (http://github.com/elliance/metaframe).
//
// ©2013 Loz Gray – Creative Commons Attribution Sharealike 3.0 Unported 
// http://creativecommons.org/licenses/by-sa/3.0/
//
// Dependancies:
//
// jquery 2.x.x
// loznotes.css
// -----------------------------------------------------------------------------
$(function(){function s(){var e=window.location.search.substring(1).split("&");if($.inArray("loznotes=hidden",e)>-1||$.inArray("loznotes=hide",e)>-1){o();v();m();g();y()}else{if($.inArray("loznotes=off",e)>-1)return!1;o();m();g();y();$("#loznotes__form__display-toggle").attr("checked","checked")}}function o(){u();e=$("[data-notation]");a();f();d();i=$(".loznotes__anchor a")}function u(){$(".loznotes__tab-pane").length>0&&$(".loznotes__anchor").add(".loznotes__tab-control").add(".loznotes__tab-pane").remove()}function a(){if($("body").data("notation")){t=$(e[0]);e=e.splice(1)}}function f(){l();r=$("<section/>",{"class":"loznotes__tab-pane"}).appendTo("body");r.html("<h1>"+document.title+"</h1>");c();h();p()}function l(){n=$("<a/>",{"class":"loznotes__tab-control",href:"#"}).appendTo("body")}function c(){var e=$('<form class="loznotes__form"><input type="checkbox" id="loznotes__form__display-toggle" />Show note markers</form><h2>Page Notes</h2>');e.appendTo(r)}function h(){t&&r.append('<p class="loznotes__page-description">'+t.data("notation")+"</p>")}function p(){var t=$("<dl/>",{"class":"loznotes__list"}).appendTo(r);for(var n=0;n<e.length;n++)t.append('<dt id= "loznote--'+(n+1)+'" class="loznote__count loznote__count-'+(n+1)+'">'+(n+1)+"</dt>"+'<dd class="loznote__body loznote__body-'+(n+1)+'">'+$(e[n]).data("notation")+"</dd>")}function d(){for(var t=0;t<e.length;t++)$(e[t]).prepend('<figure class="loznotes__anchor"><a href="#loznote--'+(t+1)+'">'+(t+1)+"</a></figure>")}function v(){i.parent().addClass("loznotes__anchor--is-hidden")}function m(){$(i).click(function(e){b();this.hash=="#loznote--1"?r.scrollTop(0):r.scrollTop($(this.hash).position().top-20);e.preventDefault()})}function g(){$(n).click(function(e){b();r.scrollTop(0);e.preventDefault()})}function y(){$("#loznotes__form__display-toggle").click(function(){i.parent().toggleClass("loznotes__anchor--is-hidden")})}function b(){n.toggleClass("loznotes__tab-control--is-active");r.toggleClass("loznotes__tab-pane--is-active")}var e,t,n,r,i;s();$(document).ajaxComplete(function(){s()})});